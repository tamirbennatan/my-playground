nested %>%
arrange(desc(lm.r.squared)) %>%
.[106,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[36,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[37,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[38,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[39,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[340,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[40,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[41,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
nested %>%
arrange(desc(lm.r.squared)) %>%
.[42,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
p1 = nested %>%
arrange(desc(lm.r.squared)) %>%
.[42,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
p2 = nested %>%
arrange(desc(lm.r.squared)) %>%
.[43,] %>%
.$data %>%
.[[1]] %>%
plot_series() +
geom_smooth(method = "lm", se = FALSE)
list(p1,p2)
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE)
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 41)) %>%
mutate(chart = map(.f = plot_linear_trend, .x = data, title = article))
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE)
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 41)) %>%
mutate(chart = purrr::map(.f = plot_linear_trend, .x = data, title = article))
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE)
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 41)) %>%
mutate(chart = purrr::map(.f = plot_linear_trend, .x = data, title = article)) %>%
.$chart
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = paste(title, "series", sep = " "))
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map(.f = plot_linear_trend, .x = data, title = article)) %>%
.$chart
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = paste(title, "series", sep = " "))
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map(.f = plot_linear_trend, .x = data, title = Page)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40))
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map(.f = plot_linear_trend, .x = data, .x2 = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = title)
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40))
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 36, 40)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 35, 40)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 50, 55)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 40, 50)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 49, 55)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
```{R}
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 49, 55)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 30, 35)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 10000, 10005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 50000, 50005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 50000, 50005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 60000, 60005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 10000, 10005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
plot_linear_trend <- function(df, title){
df %>%
ggplot(aes(x = date, y = views, color = views)) +
geom_point() +
geom_line() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = title) +
theme(legend.position = "")
}
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 49, 55)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
# plot the model with the highest R^2
nested %>%
arrange(desc(lm.r.squared)) %>%
.[1,]
# plot the model with the highest R^2
nested %>%
arrange(desc(lm.r.squared)) %>%
.[1,] %>%
mutate(chart = map2(f = plot_linear_trend, .x = data, .y = article))
# plot the model with the highest R^2
nested %>%
arrange(desc(lm.r.squared)) %>%
.[1,] %>%
mutate(chart = map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 49, 55))
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 20, 40))
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 1, 50))
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 38, 45)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 42, 47)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 50, 55)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared) %>%
.[1,] %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared)
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 30, 35)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(lm.r.squared) %>%
filter(between(row_number(), 25, 30)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
nested %>%
arrange(desc(lm.r.squared)) %>%
filter(between(row_number(), 10000, 10005)) %>%
mutate(chart = purrr::map2(.f = plot_linear_trend, .x = data, .y = article)) %>%
.$chart
library(data.table)
nested[,linear_trend:=NULL]
nested[,"linear_trend":=NULL]
nested[,c("linear_trend"):=NULL]
helop(":=")
help(":=")
is.data.table(nested)
nested[,c("linear_trend"):=NULL]
# remove the linear model column to save memory
nested <- nested %>%
select(-linear_trend)
head(nested)
first_page
?auto.arima
fit_arima <- function(df) {
auto.arima(df$views)
}
first_page %>%
mutate(arima_model = map(.x = data, .y = fit_arima))
fit_arima <- function(df) {
auto.arima(df$views)
}
first_page %>%
mutate(arima_model = purrr::map(.x = data, .y = fit_arima))
fit_arima <- function(df) {
auto.arima(df$views)
}
first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima))
first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]] %>%
glance()
first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]] %>%
tidy()
first.model = first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
first.model
fit_arima <- function(df) {
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE )
}
first.model = first_page %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
first.model
first.model = nested[4333,] %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
first.model
nested[4333,] %>%
.$data %>%
.[[1]] %>%
plot_series()
plot(first.model)
forecast(first.model)
plot(forecast(first.model))
first.model = nested[352525,] %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
first.model = nested[35225,] %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
plot(forecast(first.model))
first.model = nested[22,] %>%
mutate(arima_model = purrr::map(.x = data, .f = fit_arima)) %>%
.$arima_model %>%
.[[1]]
plot(forecast(first.model))
getwd()
setwd("./Desktop/my-playground/wikipedia-forecasting/")
list.files()
save.image()
first_page %>%
mutate(model = purrr::map(.f = fit.arima, .x = data))
first_page %>%
mutate(model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE, max.order = 3)
}
first_page %>%
mutate(model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE)
}
first_page %>%
mutate(model = purrr::map(.f = fit_arima, .x = data))
first_page %>%
mutate(model = purrr::map(.f = apply_lm, .x = data))
first_page %>%
mutate(model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE)
}
nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
nested <- nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE)
},
error = function() {
NULL
}
finally = {}
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE)
},
error = function() {
NULL
},
finally = {}
)
}
first_page %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
auto.arima(series, seasonal = TRUE)
},
error = function() {
NULL
},
finally = {}
)
}
first_page %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
return(auto.arima(series, seasonal = TRUE))
},
error = function() {
return(NA)
},
finally = {}
)
}
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
return(auto.arima(series))
},
error = function() {
return(NA)
},
finally = {}
)
}
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
return(auto.arima(series))
},
error = function() {
print("Failing")
return(NA)
},
finally = {}
)
}
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
fit_arima <- function(df) {
tryCatch({
series = ts(df$views, frequency = 7)
auto.arima(series)
},
error = function(cond) {
NA
},
finally = {}
)
}
nested = nested %>%
mutate(arima_model = purrr::map(.f = fit_arima, .x = data))
